import{i as j,E as D}from"./DragVerticalIcon-fa78fa9d.js";import{F as I}from"./FieldLayout-75a1161d.js";import{u as Q}from"./index-d7cc16ab.js";import{s as q}from"./statuses-49e6ff4d.js";import{N as F,a0 as T,O as U,a7 as z,l as h,y as A,X as w,a as G,e as _,f as d,g as c,w as P,d as n,t as W,u as r,B as v,b as M,aa as X,G as $}from"./index-69690053.js";import{u as H,c as J,q as K}from"./modals-062b592e.js";import{u as Y}from"./helpCenter-6956e896.js";const Z={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},ee={class:"mb-5 flex items-center justify-between"},ae={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},se={class:"flex items-center gap-1"},te={class:"px-4 pb-7 pt-4 sm:px-6"},oe={class:"flex flex-row-reverse gap-2"},me={__name:"LeadModal",props:F({defaults:Object},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const E=b,{user:k}=T(),{getUser:x,isManager:L}=Q(),{getLeadStatus:C,statusOptions:N}=q(),{updateOnboardingStep:S}=Y("frappecrm"),u=U(b,"modelValue"),V=z(),s=h(null),i=h(!1),{document:e,triggerOnBeforeCreate:m}=H("CRM Lead"),f=A(()=>{var t;let a=N("lead");return e.doc.status||(e.doc.status=(t=a==null?void 0:a[0])==null?void 0:t.value),a}),g=w({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Lead"],params:{doctype:"CRM Lead",type:"Quick Entry"},auto:!0,transform:a=>a.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(p=>{p.fields.forEach(l=>{l.fieldname=="status"&&(l.fieldtype="Select",l.options=f.value,l.prefix=C(e.doc.status).color),l.fieldtype==="Table"&&(e.doc[l.fieldname]=[])})})})})}),R=w({url:"frappe.client.insert"});async function B(){e.doc.website&&!e.doc.website.startsWith("http")&&(e.doc.website="https://"+e.doc.website),await(m==null?void 0:m()),R.submit({doc:{doctype:"CRM Lead",...e.doc}},{validate(){if(s.value=null,!e.doc.first_name)return s.value=__("First Name is mandatory"),s.value;if(e.doc.annual_revenue){if(typeof e.doc.annual_revenue=="string")e.doc.annual_revenue=e.doc.annual_revenue.replace(/,/g,"");else if(isNaN(e.doc.annual_revenue))return s.value=__("Annual Revenue should be a number"),s.value}if(e.doc.mobile_no&&isNaN(e.doc.mobile_no.replace(/[-+() ]/g,"")))return s.value=__("Mobile No should be a number"),s.value;if(e.doc.email&&!e.doc.email.includes("@"))return s.value=__("Invalid Email"),s.value;if(!e.doc.status)return s.value=__("Status is required"),s.value;i.value=!0},onSuccess(a){X("lead_created"),i.value=!1,u.value=!1,V.push({name:"Lead",params:{leadId:a.name}}),S("create_first_lead",!0,!1,()=>{localStorage.setItem("firstLead"+k,a.name)})},onError(a){if(i.value=!1,!a.messages){s.value=a.message;return}s.value=a.messages.join(`
`)}})}function O(){J.value=!0,K.value={doctype:"CRM Lead"},$(()=>u.value=!1)}return G(()=>{var a,t,o;e.doc={no_of_employees:"1-10"},Object.assign(e.doc,E.defaults),(a=e.doc)!=null&&a.lead_owner||(e.doc.lead_owner=x().name),!((t=e.doc)!=null&&t.status)&&((o=f.value[0])!=null&&o.value)&&(e.doc.status=f.value[0].value)}),(a,t)=>{const o=_("Button"),p=_("ErrorMessage"),l=_("Dialog");return d(),c(l,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=y=>u.value=y),options:{size:"3xl"}},{body:P(()=>[n("div",Z,[n("div",ee,[n("div",null,[n("h3",ae,W(a.__("Create Lead")),1)]),n("div",se,[r(L)()&&!r(j)?(d(),c(o,{key:0,variant:"ghost",class:"w-7",tooltip:a.__("Edit fields layout"),icon:D,onClick:O},null,8,["tooltip"])):v("",!0),M(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=y=>u.value=!1),icon:"x"})])]),n("div",null,[r(g).data?(d(),c(I,{key:0,tabs:r(g).data,data:r(e).doc},null,8,["tabs","data"])):v("",!0),s.value?(d(),c(p,{key:1,class:"mt-4",message:a.__(s.value)},null,8,["message"])):v("",!0)])]),n("div",te,[n("div",oe,[M(o,{variant:"solid",label:a.__("Create"),loading:i.value,onClick:B},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}};export{me as _};
//# sourceMappingURL=LeadModal-46cb1510.js.map
